(function () {/*
 David Rekow 2014
*/
function e(a,b,c){var d;this._prop={};this._cb={};b&&(c=c||"",Object.defineProperty(this,"_root",{value:b}),Object.defineProperty(this,"_path",{value:c}));for(d in a)a.hasOwnProperty(d)&&"function"!==typeof a[d]&&this.bind(d,a[d])}
e.prototype={get:function(a){return k(this,a)},set:function(a,b){if("object"===typeof a&&"undefined"===typeof b)for(a in b=a,b)b.hasOwnProperty(a)&&k(this,a,b[a]);else k(this,a,b)},remove:function(a){var b;if(this._root)return this._root.remove(this._path+"."+a);for(b in this._cb)this._cb.hasOwnProperty(b)&&0===b.indexOf(a)&&b!==a&&this.get(b)&&l(this,b,null,this);this[a]=void 0},replace:function(a){var b,c;if("object"!==typeof a)throw new TypeError("Fragment.replace() expects an object as the only parameter.");
for(b in this._prop)this._prop.hasOwnProperty(b)&&void 0===a[b]&&(this[b]=null);for(b in a)a.hasOwnProperty(b)&&(c=this.get(b),c instanceof e&&c.replace(a[b]||{}),this.set(b,a[b]))},watch:function(a,b){if(this._root)return this._root.watch(this._path+"."+a,b);this._cb[a]||(this._cb[a]=[]);this._cb[a].push(b)},unwatch:function(a,b){var c;if(this._root)return this._root.unwatch(this._path+"."+a,b);this._cb[a]&&(b?(c=this._cb[a].indexOf(b),-1<c&&this._cb[a].splice(c,1)):this._cb[a]=[])},toJSON:function(){return this._prop},
constructor:e,bind:function(a,b){Object.defineProperty(this,a,{enumerable:!0,get:function(){return this._prop[a]},set:function(b){if(null===b)return this.remove(a);this._prop[a]=b;l(this,a,b,this)}});this.set(a,b)}};function l(a,b,c,d){if(a._root)return l(a._root,a._path+"."+b,c,d);(a=a._cb[b])&&a.forEach(function(a){a.call(d,c)})}
function k(a,b,c){b=b.split(".");var d=b.pop(),f=a._path||"",n=a._root||a,g,h;for(h=0;h<b.length;h++){g=b[h];f+="."+g;if(!a.hasOwnProperty(g)){if(void 0===c||null===c)return null;a.bind(g,new e(null,n,f))}a=a[g]}f+=f?"."+d:d;if(void 0===c)return a[d];a.hasOwnProperty(d)||a.bind(d);if("object"===typeof c){if(a[d]instanceof e)return a[d].set(c);c instanceof e||c instanceof Array||(c=new e(c,n,f))}a[d]=c}function m(a,b){return a instanceof e?b?(a._root=b,a):a:new e(a,b)}
"undefined"!==typeof window&&window.self===window&&(window.panoptic=m);"undefined"!==typeof module&&"object"===typeof module.exports&&(module.exports=m);"function"===typeof define&&define("panoptic",m);}).call(this);
