(function () {/*
 David Rekow 2014
*/
function d(a,b,c){var e;a=a||{};this._prop={};this._cb={};this._root=b||null;this._path="string"===typeof c?c:"";for(e in a)a.hasOwnProperty(e)&&"function"!==typeof a[e]&&this.bind(e,a[e])}d.prototype.get=function(a){return f(this,a)};d.prototype.set=function(a,b){if("object"===typeof a&&"undefined"===typeof b)for(a in b=a,b)b.hasOwnProperty(a)&&f(this,a,b[a]);else f(this,a,b)};
d.prototype.replace=function(a){var b,c;if("object"!==typeof a)throw new TypeError("Fragment.replace() expects an object as the only parameter.");for(b in this._prop)this._prop.hasOwnProperty(b)&&void 0===a[b]&&(this[b]=null);for(b in a)a.hasOwnProperty(b)&&(c=this.get(b),c instanceof d&&c.replace(a[b]||{}),this.set(b,a[b]))};d.prototype.watch=function(a,b){if(this._root)return this._root.watch(this._path+"."+a,b);this._cb[a]||(this._cb[a]=[]);this._cb[a].push(b)};
d.prototype.unwatch=function(a,b){var c;if(this._root)return this._root.unwatch(this._path+"."+a,b);this._cb[a]&&(b?(c=this._cb[a].indexOf(b),-1<c&&this._cb[a].splice(c,1)):this._cb[a]=[])};d.prototype.toJSON=function(){return this._prop};
d.prototype.bind=function(a,b){Object.defineProperty(this,a,{enumerable:!0,get:function(){return this._prop[a]},set:function(b){null===b&&(this.remove(a),b=void 0);if(!("object"!==typeof b||b instanceof d||b instanceof k)){if(b.constructor!==Array)return f(this,a,b);b=new k(b,this._root||this,this._path?this._path+"."+a:a)}this._prop[a]=b;this.emit(a,b,this)}});this.set(a,b)};
d.prototype.emit=function(a,b,c){if(this._root)return this._root.emit(this._path+"."+a,b,c);(a=this._cb[a])&&a.forEach(function(a){a.call(c,b)})};d.prototype.remove=function(a){var b;if(this._root)return this._root.remove(this._path+"."+a);for(b in this._cb)this._cb.hasOwnProperty(b)&&0===b.indexOf(a)&&b!==a&&this.get(b)&&this.emit(b,null,this)};
function f(a,b,c){b=b.split(".");var e=b.pop(),g=a._path||"",m=a._root||a,h,l;for(l=0;l<b.length;l++){h=b[l];g+=g?"."+h:h;if(!a[h]){if(void 0===c||null===c)return null;a.hasOwnProperty(h)?a[h]=new d(null,m,g):a.bind(h,new d(null,m,g))}a=a[h]}g+=g?"."+e:e;if(void 0===c)return a[e];a.hasOwnProperty(e)||a.bind(e);if("object"===typeof c){if(a[e]instanceof d)return a[e].set(c);c instanceof d||c instanceof Array||(c=new d(c,m,g))}a[e]=c}
function k(a,b,c){this.length=0;Object.defineProperty(this,"emit",{value:function(a){return!0===a?b.emit(c+".length",this.length,b):b.emit(c,this,b)}});a&&Array.prototype.push.apply(this,a)}k.prototype=Object.create(Array.prototype);Object.defineProperty(k.prototype,"constructor",{value:k});Object.defineProperty(k.prototype,"push",{value:function(a){var b=this.length;Array.prototype.push.apply(this,arguments[1]?arguments:[a]);this.emit();this.length!==b&&this.emit(!0);return this.length}});
Object.defineProperty(k.prototype,"unshift",{value:function(a){var b=this.length;Array.prototype.unshift.apply(this,arguments[1]?arguments:[a]);this.emit();this.length!==b&&this.emit(!0);return this.length}});Object.defineProperty(k.prototype,"pop",{value:function(){var a=this.length,b=Array.prototype.pop.call(this);this.emit();this.length!==a&&this.emit(!0);return b}});
Object.defineProperty(k.prototype,"shift",{value:function(){var a=this.length,b=Array.prototype.shift.call(this);this.emit();this.length!==a&&this.emit(!0);return b}});Object.defineProperty(k.prototype,"splice",{value:function(a,b,c){var e=this.length;c=Array.prototype.splice.apply(this,arguments);this.emit();this.length!==e&&this.emit(!0);return c}});Object.defineProperty(k.prototype,"toJSON",{value:function(){return this.slice()}});
function n(a,b){return a instanceof d?b?(a._root=b,a):a:new d(a,b)}"undefined"!==typeof window&&window.self===window&&(window.panoptic=n);"undefined"!==typeof module&&"object"===typeof module.exports&&(module.exports=n);"function"===typeof define&&define("panoptic",n);}).call(this);
